javascript: console.log(`获取图片书签by leizingyiu
Last modified : "2021/12/06 12:29:19"
`);
!function () { function evil(str) { var script = document.createElement("script"); script.type = "text/javascript", script.text = str, document.getElementsByTagName("head")[0].appendChild(script), document.head.removeChild(document.head.lastChild) } for (var replaceWhiteList = ["instagram.com"], replaceBoo = !0, pageSetUp = { divId: "imgsByYiu", imgClass: "daImgByYiu", otherHtml: '<div id="popbgByYiu"></div> <p id="popDiv"><img id="popImg"></p>', style: "\n            #imgsByYiu li{\n                display:inline;\n                position:relative;\n            }\n\n            #imgsByYiu li i{\n                position: absolute;\n                right: 2vh;\n                bottom: 2vh;\n                font-size: 0.8rem;\n                letter-spacing: 0.1rem;\n                line-height: 1em;\n                padding: 0.5vh;\n                background: rgba(0,0,0,0.5);\n                color: #fff;\n            }\n            img.daImgByYiu {\n                max-height: 50vh;   margin: 1vh;   transition: auto;  transition: 0.5s; cursor: pointer;\n            }\n\n            img.daImgByYiu:hover {\n                box-shadow: rgb(30 132 220 / 19% ) 0px 10px 50px, rgb(30 132 220 / 20% ) 0px 2px 10px;  transform: scale(1.01);\n            }\n\n            .popbgByYiuOn {\n                position: fixed; width: 100% ;    height: 100% ;  z - index: 999;   background: rgb(255 255 255 / 0.6);    top: 0; left: 0;    cursor: pointer;\n            }\n\n            #popDiv {\n                display: block; position: fixed;    top: 50% ;  left: 50% ; z-index: 1000;  transform: translate(-50% , -50% ); overflow: auto; width: auto;    height: 100vh;  margin: 0;\n            }\n\n            #popImg {\n                position: relative; max-height: 100vh;  cursor: zoom-in ;\n            }\n\n            .popDivZoomedIn{\n                height: 100vh!important;\n            }\n            .popDivZoomedIn100Vw{\n                height: 100vh!important;                width:100vw!important;\n            }\n            .popDivZoomedIn img,.popDivZoomedIn100Vw img{\n                max-height:none!important;  max-width:none!important;cursor: zoom-out!important;\n            }\n\n            .popDivZoomedOut{\n                height: auto!important;\n            }\n            .popDivZoomedOut img{\n                max-height:98vh!important;                max-width:80vw!important;\n            }\n\n            *{transition: 0.5s;}\n            #newBody{background:#fff;}\n            #popDiv::-webkit-scrollbar {display: none;}\n            .blur {\t\n                filter: url(blur.svg#blur); /* FireFox, Chrome, Opera */\n                -webkit-filter: blur(10px); /* Chrome, Opera */\n                   -moz-filter: blur(10px);\n                    -ms-filter: blur(10px);    \n                        filter: blur(10px);\n                filter: progid:DXImageTransform.Microsoft.Blur(PixelRadius=10, MakeShadow=false); /* IE6~IE9 */\n            }\n        ", scripts: '\n        console.log("script run!!");\n        p = document.querySelectorAll("#imgsByYiu img.daImgByYiu");\n\n        function getImgNaturalDimension(img, callback) {\n          if (typeof img.naturalWidth == "undefined") {\n            var temImg = new Image();\n            temImg.onload = function() {\n              callback({width: temImg.width, height:temImg.height});\n            };\n            temImg.src = img.src;\n          } else {\n            callback({width: img.naturalWidth, height:img.naturalHeight});\n          }\n        }\n\n        function onImg() {\n            document.getElementsByTagName(\'html\')[0].style.overflow="hidden";\n            document.getElementById("imgsByYiu").className+=" blur ";\n            console.log(document.getElementsByTagName(\'html\')[0].style.overflow);\n\n\t\t\t\n        \tdocument.getElementById("popDiv").className = "popDivOn";\n\n        \tvar daimg = document.getElementById("popImg");\n        \tdaimg.src = this.src;\n        \tdaimg.style.display = "block";\n\n        \tdocument.getElementById("popImg").className = "popImgOn";\n        \tdocument.getElementById("popbgByYiu").className = "popbgByYiuOn";\n\n            document.getElementById("popDiv").className=\'popDivZoomedOut\';\n            \n        }\n        console.log("defined onImg()");\n\n        for (i = 0; i < p.length; i++) {\n        \tp[i].onclick = onImg;\n        }\n        function offImg() {\n\n            document.getElementsByTagName(\'html\')[0].style.overflow="initial";\n            document.getElementById("imgsByYiu").className=document.getElementById("imgsByYiu").className.replace("blur","");\n\n        \tdocument.getElementById("popbgByYiu").className = "";\n        \tdocument.getElementById("popDiv").className = "";\n\n        \tvar daimg = document.getElementById("popImg");\n        \tdaimg.style.display = "none";\n        \tdaimg.className = "";\n        \tdaimg.src = "";\n        }\n        console.log("defined offImg()");\n\n        document.getElementById("popbgByYiu").onclick = offImg;\n        \n        document.getElementById("popImg").onclick = function() {\n            console.log("click popImg");\n            getImgNaturalDimension(this , function(dimension){\n                console.log("实际尺寸：", dimension.width, dimension.height);\n                console.log(document.body.clientWidth,document.body.clientHeight);\n                if(dimension.width>window.innerWidth || dimension.height>window.innerHeight){\n                    popDiv = document.getElementById("popDiv");\n                    if(dimension.width>window.innerWidth){\n                        popDiv.className=popDiv.className==\'popDivZoomedIn100Vw\'?\'popDivZoomedOut\':\'popDivZoomedIn100Vw\';\n                        popDiv.scrollLeft=(popDiv.scrollWidth-popDiv.offsetWidth)/2;\n                        popDiv.scrollTop=(popDiv.scrollHeight-popDiv.offsetHeight)/2;\n                    }else{\n                        popDiv.className=popDiv.className==\'popDivZoomedIn\'?\'popDivZoomedOut\':\'popDivZoomedIn\';\n                    }\n                    \n                    \n                }else{\n                    document.getElementById("popDiv").className=\'popDivZoomedOut\';\n                    document.getElementById("popImg").style.cursor=\'default\';\n                }\n            })\n        };\n        console.log("defined #popImg.onclick()");\n\n\n    ' }, replaceSomeWeb = { "huabanimg.com": { reg: /_fw\d*(\/format\/.*)*/g, result: "" }, "sinaimg.cn": { reg: /(\.sinaimg\.cn\/)([^/]+)(\/)/g, result: "$1large$3" }, "alicdn.com": { reg: /(\S+)(jpg|png|jpeg|gif)(.+)/gi, result: "$1$2" }, "pinimg.com": { reg: /(i.pinimg.com\/)[^\/]+(.+)/, result: "$1originals$2" }, "xiaohongshu.com": { reg: /(.+)\?.+/, result: "$1" }, "duitang.com": { reg: /\.thumb\.\d*_\d*/, result: "" }, "dribbble.com": { reg: /\?[^\?]*/, result: "" }, "googleusercontent.com": { reg: /(=[wh])\d*$/, result: "$19999" }, "media.niftygateway.com": { reg: /(upload\/).*(\/v\d{8,})/, result: "$1$2" }, "cdn.dribbble.com": { reg: /\?.*$/, result: "" } }, i = 0; i < replaceWhiteList.length; i++)-1 != window.location.href.indexOf(replaceWhiteList[i]) && (replaceBoo = !1); function main() { var imgSrcList = imgLinkArray(document, replaceBoo, replaceSomeWeb), bgUrlList = bgImgLinkArray(document, replaceBoo, replaceSomeWeb), aHrefLink = ahrefImgLinkArray(document, replaceBoo, replaceSomeWeb), mySrcList = [], pageCodeBlock; mySrcList = mySrcList.concat(imgSrcList, bgUrlList, aHrefLink), [...document.getElementsByTagName("iframe")].map(frame => { try { frameDoc = frame.contentWindow.document, imgSrcList = imgLinkArray(frameDoc, replaceBoo, replaceSomeWeb), bgUrlList = bgImgLinkArray(frameDoc, replaceBoo, replaceSomeWeb), aHrefLink = ahrefImgLinkArray(frameDoc, replaceBoo, replaceSomeWeb), mySrcList = mySrcList.concat(imgSrcList, bgUrlList, aHrefLink) } catch (err) { } }), replaceFullPage(makeImgsCodeBlock((mySrcList = (mySrcList = [...new Set(mySrcList)]).reverse()).reverse(), pageSetUp.divId, pageSetUp.imgClass, pageSetUp.otherHtml, pageSetUp.style, pageSetUp.scripts)); try { evil(pageSetUp.scripts) } catch (err) { console.log(err) } [...document.querySelectorAll("img")].map((function (img) { "popImg" != img.id && (img.onload = function () { sizeTheImgs(img.parentElement) }) })) } function imgLinkArray(obj, replaceBoo, replaceSomeWeb) { for (var result = [], reg = /(\S+)(jpg|png|jpeg|gif|webp|bmp)(.+)/gi, regData = /^data.*/g, i = 0; i < obj.images.length; i++) { if (obj.images[i].hasAttribute("src")) result[result.length] = obj.images[i].src; else if (obj.images[i].hasAttribute("lazy-scr-load")) result[result.length] = obj.images[i].attributes["lazy-src-load"].value; else try { result[result.length] = obj.images[i].attributes[0].value } catch (err) { } 1 != regData.test(result[result.length - 1]) && replaceBoo && (result[result.length] = result[result.length - 1].replace(reg, "$1$2")), result[result.length] = regReplaceForSomeWeb(result[result.length - 1], replaceSomeWeb) } return result } function bgImgLinkArray(obj, replaceBoo, replaceSomeWeb) { let result = [], all = obj.querySelectorAll("*"), bg = "", reg = /(?:['"])[^'"]+/g, reg2 = /(\S+)(jpg|png|jpeg|gif|webp|bmp)(.+)/gi; for (let j = 0; j < all.length; j++)console.log(all[j].style), console.log(all[j].style.backgroundImage), "" != all[j].style.backgroundImage && null != all[j].style.backgroundImage && (bg = all[j].style.backgroundImage.match(reg), console.log(bg), "" != bg && null != bg && [...bg].map(i => { result[result.length] = i.replace(/^['"]/, ""), result[result.length - 1] = 1 == replaceBoo ? result[result.length - 1].replace(reg2, "$1$2") : result[result.length - 1], result[result.length - 1] = regReplaceForSomeWeb(result[result.length - 1], replaceSomeWeb) })); return result } function ahrefImgLinkArray(obj, replaceBoo, replaceSomeWeb) { let result = [], all = obj.querySelectorAll("a"), reg = /(url\(")(.*)("\))/g, reg2 = /(\S+)(jpg|png|jpeg|gif)(.+)/gi; for (let j = 0; j < all.length; j++)bg = all[j].href.match(/(\.jpg)|(\.gif)|(\.png)|(\.jpeg)|(\.webp)/) ? all[j].href : "", "" == bg && null == bg || (result[result.length] = String(bg).replace(reg, "$2"), result[result.length - 1] = 1 == replaceBoo ? result[result.length - 1].replace(reg2, "$1$2") : result[result.length - 1], result[result.length - 1] = regReplaceForSomeWeb(result[result.length - 1], replaceSomeWeb)); return result } function sizeTheImgs(dom) { let img = dom.querySelectorAll("img"); for (let i = 0; i < img.length; i++) { let size = getImgNaturalDimensions(img[i]), w = size[0], h = size[1], I = document.createElement("i"); I.innerText = w + "x" + h, img[i].parentNode.appendChild(I) } } function getImgNaturalDimensions(img, callback = function () { }) { var nWidth, nHeight; if (null != img.naturalWidth) nWidth = img.naturalWidth, nHeight = img.naturalHeight; else { var image = new Image; image.src = img.src, image.onload = function () { callback(image.width, image.height) } } return [nWidth, nHeight] } function makeImgsCodeBlock(imgList, divId, imgClass, otherHtml, style, scripts) { let result = document.createElement("div"), ul = document.createElement("ul"); var li, img; ul.id = divId, result.appendChild(ul), console.log(imgList instanceof Array), imgList instanceof Array ? (imgList.map(image => { li = document.createElement("li"), (img = document.createElement("img")).classList.add(imgClass), img.src = image.replace(/_\/fw\/\d*\/format\/.*/g, ""), ul.appendChild(li), li.appendChild(img) }), console.log(ul)) : (Object.keys(imgList).map(k => { li = document.createElement("li"), (img = document.createElement("img")).classList.add(imgClass), img.src = imgList[k].replace(/_\/fw\/\d*\/format\/.*/g, ""), ul.appendChild(li), li.appendChild(img) }), console.log(ul)), console.log(imgList, result); let styleDom = document.createElement("style"), scriptDom = document.createElement("script"); styleDom.innerHTML = style, scriptDom.innerHTML = scripts; let tempDom = document.createElement("div"); return tempDom.innerHTML = otherHtml, [...tempDom.children].map(dom => { result.appendChild(dom) }), result.appendChild(styleDom), result.appendChild(scriptDom), result } function regReplaceForSomeWeb(str, replaceSomeWeb) { var result = ""; for (let r in replaceSomeWeb) -1 != str.indexOf(r) && (result = str.replace(replaceSomeWeb[r].reg, replaceSomeWeb[r].result)); return "" == result && (result = str), result } function replaceFullPage() { var sourceOnKeyDownStr = null == document.onkeydown ? "null" : document.onkeydown.toString(), objs = arguments, resultObj = document.createElement("div"); resultObj.id = "replacePageAsObjs"; for (let i in objs) objs[i] instanceof HTMLElement ? resultObj.appendChild(objs[i]) : resultObj.innerHTML += objs[i]; var sourceBody = document.getElementsByTagName("body")[0], html = document.getElementsByTagName("html")[0], newBody = document.createElement("body"); newBody.id = "newBody", newBody.appendChild(resultObj), html.appendChild(newBody), sourceBody.style.display = "none"; var recovery = function (hiddenBody, sourceBody) { var html = document.getElementsByTagName("html")[0], body = document.getElementsByTagName("body"); html.removeChild(document.getElementById("newBody")); for (let i = 0; i < body.length; i++)body[i].style.display = "" }; document.onkeydown = function (event) { var e = event || window.e, keyCode = e.keyCode || e.which; switch (keyCode) { case 27: document.getElementsByTagName("html")[0].style.overflow = "initial", recovery(sourceBody, newBody), document.onkeydown = eval(sourceOnKeyDownStr) } } } main(), console.log("来关注我微博 @leizingyiu 呀，虽然不怎么更新😀") }();